<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>VOX OBR - SENTENCE MODE</title>
    <style>
        :root {
            --primary: #FFD700; /* Amarillo Viral del Video */
            --bg-overlay: rgba(0, 0, 0, 0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: #000;
            color: #fff;
            font-family: 'Arial Black', 'Helvetica Neue', sans-serif; /* Fuente más gruesa */
            margin: 0;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* VIDEO DE FONDO */
        #camera-feed {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        /* HUD */
        #hud-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.8) 100%);
            z-index: 10;
        }

        .top-bar {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px #000;
        }

        .rec-indicator {
            color: red;
            font-weight: bold;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* VISUALIZADOR Y TEXTO */
        .center-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        canvas {
            width: 100%;
            height: 120px;
            opacity: 0.8;
            /* Filtro para que la onda se vea brillante */
            filter: drop-shadow(0 0 8px rgba(0, 255, 0, 0.8));
        }

        #ghost-word {
            font-size: 2.8rem;
            font-weight: 900;
            text-align: center;
            color: var(--primary); /* Amarillo */
            /* Borde negro fuerte para leerse sobre cualquier fondo */
            text-shadow: 
                3px 3px 0 #000,
                -1px -1px 0 #000,  
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
            text-transform: uppercase;
            line-height: 1.1;
            max-width: 90%;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-bottom: 20px;
        }

        /* CONTROLES */
        .controls {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        #log {
            width: 100%;
            height: 60px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
            text-align: center;
            overflow: hidden;
            margin-bottom: 10px;
            text-shadow: 1px 1px 1px #000;
        }

        #power-btn {
            background: rgba(255, 0, 0, 0.7);
            border: 2px solid #fff;
            color: white;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.4);
        }

    </style>
</head>
<body>

    <video id="camera-feed" autoplay playsinline muted></video>

    <div id="hud-layer">
        <div class="top-bar">
            <div>OBR INTELLIGENT V4</div>
            <div class="rec-indicator">● REC</div>
        </div>

        <div class="center-display">
            <canvas id="scope"></canvas>
            <div id="ghost-word"></div>
        </div>

        <div class="controls">
            <div id="log"></div> <button id="power-btn">INICIAR SISTEMA</button>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS OBR ---
        
        // 1. Palabras sueltas (70% chance)
        const simpleWords = [
            "SI", "NO", "AQUI", "FUERA", "MAMA", "PAPA", "AGUA", "FUEGO", "RIO", "CANAL",
            "SOLO", "FRIO", "MIEDO", "AYUDA", "CORRE", "ATRAS", "MIRA", "BAJO", "LUZ",
            "CRUZ", "DIOS", "ROJO", "NEGRO", "SANGRE", "NIÑO", "NIÑA", "NOMBRE", "TUMBA",
            "LLAVE", "PUERTA", "MUERTO", "VIVO", "AYER", "HOY", "JUEGO", "ESCUELA"
        ];

        // 2. Frases Inteligentes (30% chance - Estilo Video)
        const smartPhrases = [
            "NO SE ASUSTEN",
            "ME AHOGUÉ",
            "ESTOY AQUÍ",
            "NO ME VEO",
            "BUSCO A MAMÁ",
            "FUE UN ACCIDENTE",
            "AYUDA POR FAVOR",
            "HACE MUCHO FRÍO",
            "EN EL CANAL",
            "SOY EL NIÑO",
            "QUIERO IRME",
            "ESTOY ATRAPADO",
            "MIRA ATRÁS",
            "NO TE VAYAS",
            "ESTOY TRISTE",
            "YA ESTOY MUERTO",
            "BAJO EL PUENTE",
            "NO PUEDO SALIR",
            "ESCUCHA MI VOZ",
            "ELLOS VIENEN"
        ];

        let isRunning = false;
        let ac, mic, analyser, radioNode, radioGain;
        let canvas, ctx;
        
        const els = {
            video: document.getElementById('camera-feed'),
            word: document.getElementById('ghost-word'),
            log: document.getElementById('log'),
            btn: document.getElementById('power-btn'),
            canvas: document.getElementById('scope')
        };

        async function start() {
            try {
                // Pedir permisos de Camara y Micrófono
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' }, 
                    audio: true 
                });
                els.video.srcObject = stream;

                // Iniciar Audio
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                ac = new AudioContext();
                
                // Micrófono para visualizador
                mic = ac.createMediaStreamSource(stream);
                analyser = ac.createAnalyser();
                analyser.fftSize = 512;
                mic.connect(analyser);

                // Radio de fondo (Spirit Box)
                setupRadio();

                // Loop Visual
                loopGraphics();

                // Loop Lógico (Cerebro)
                setInterval(brainLoop, 200);

                isRunning = true;
                els.btn.style.display = 'none'; // Ocultar botón al iniciar para limpiar pantalla

            } catch (e) {
                alert("Error: Se requieren permisos de cámara y micrófono.");
            }
        }

        function setupRadio() {
            // Ruido blanco
            const bufferSize = 2 * ac.sampleRate;
            const buffer = ac.createBuffer(1, bufferSize, ac.sampleRate);
            const data = buffer.getChannelData(0);
            for(let i=0; i<bufferSize; i++) data[i] = Math.random() * 2 - 1;

            radioNode = ac.createBufferSource();
            radioNode.buffer = buffer;
            radioNode.loop = true;

            // Filtro estilo radio AM
            const filter = ac.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 900;

            radioGain = ac.createGain();
            radioGain.gain.value = 0.05; // Volumen bajo

            radioNode.connect(filter);
            filter.connect(radioGain);
            radioGain.connect(ac.destination);
            radioNode.start();
        }

        // --- CEREBRO OBR ---
        let lastTrigger = 0;

        function brainLoop() {
            if(!isRunning) return;

            // Simulación de "Escucha Activa"
            // En una app real, aquí analizaríamos picos de EMF o Audio.
            // Aquí usamos una probabilidad ajustada para que no hable demasiado (spam)
            // pero tampoco se quede callada.
            
            const now = Date.now();
            const timeSinceLast = now - lastTrigger;
            
            // Probabilidad base baja (1%) cada 200ms
            let probability = 0.01; 

            // Si ha pasado mucho tiempo (10 seg) sin hablar, sube probabilidad
            if (timeSinceLast > 10000) probability = 0.05;

            if (Math.random() < probability && timeSinceLast > 3000) {
                triggerVoice();
                lastTrigger = now;
            }
        }

        function triggerVoice() {
            // DECISIÓN INTELIGENTE: ¿Palabra o Frase?
            const isPhrase = Math.random() > 0.6; // 40% chance de frase compleja
            
            let text = "";
            if (isPhrase) {
                text = smartPhrases[Math.floor(Math.random() * smartPhrases.length)];
            } else {
                text = simpleWords[Math.floor(Math.random() * simpleWords.length)];
            }

            // Mostrar visualmente (Estilo Video: Guión antes del texto)
            const displayText = "-" + text;
            els.word.innerText = displayText;
            els.word.style.opacity = 1;
            els.word.style.transform = "scale(1.1)";

            // Añadir al log (historial)
            const logItem = document.createElement('div');
            logItem.innerText = displayText;
            els.log.prepend(logItem);

            // Audio Ducking (Bajar radio)
            const prevVol = radioGain.gain.value;
            radioGain.gain.linearRampToValueAtTime(0.01, ac.currentTime + 0.1);

            // Hablar
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'es-MX';
            u.rate = 0.85; // Un poco lento
            u.pitch = isPhrase ? 0.6 : 0.8; // Frases más graves/serias
            u.onend = () => {
                // Subir radio de nuevo
                radioGain.gain.linearRampToValueAtTime(prevVol, ac.currentTime + 1);
                // Ocultar texto
                setTimeout(() => {
                    els.word.style.opacity = 0;
                    els.word.style.transform = "scale(0.8)";
                }, 2000);
            };
            window.speechSynthesis.speak(u);
        }

        // --- GRÁFICOS ---
        function loopGraphics() {
            if(!isRunning) return;
            requestAnimationFrame(loopGraphics);

            if(!ctx) {
                els.canvas.width = els.canvas.offsetWidth;
                els.canvas.height = els.canvas.offsetHeight;
                ctx = els.canvas.getContext('2d');
            }

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteTimeDomainData(dataArray);

            ctx.clearRect(0, 0, els.canvas.width, els.canvas.height);
            ctx.lineWidth = 4;
            ctx.strokeStyle = '#00FF00'; // Verde brillante
            ctx.beginPath();

            const sliceWidth = els.canvas.width * 1.0 / bufferLength;
            let x = 0;

            for(let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                // Exagerar el movimiento para que se vea genial en video
                const y = (v * els.canvas.height / 2) + ((v-1)*20); 

                if(i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);

                x += sliceWidth;
            }
            ctx.stroke();
        }

        els.btn.addEventListener('click', start);

    </script>
</body>
</html>
